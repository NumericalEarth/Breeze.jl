var documenterSearchIndex = {"docs":
[{"location":"references/#References","page":"References","title":"References","text":"","category":"section"},{"location":"references/","page":"References","title":"References","text":"Chammas,¬†S.; Wang,¬†Q.; Schneider,¬†T.; Ihme,¬†M.; Chen,¬†Y.-f. and Anderson,¬†J. (2023). Accelerating Large-Eddy Simulations of Clouds With Tensor Processing Units. Journal¬†of¬†Advances¬†in¬†Modeling¬†Earth¬†Systems 15, e2023MS003619.\n\n\n\nPauluis,¬†O. (2008). Thermodynamic consistency of the anelastic approximation for a moist atmosphere. Journal¬†of¬†the¬†Atmospheric¬†Sciences 65, 2719‚Äì2729.\n\n\n\nStraka,¬†J.¬†M. (2009). Cloud and precipitation microphysics: Principles and parameterizations (Cambridge University Press).\n\n\n\n","category":"page"},{"location":"api/#API-Documentation","page":"API","title":"API Documentation","text":"","category":"section"},{"location":"api/#Breeze.Breeze","page":"API","title":"Breeze.Breeze","text":"Julia package for finite volume GPU and CPU large eddy simulations (LES) of atmospheric flows. The abstractions, design, and finite volume engine are based on Oceananigans.\n\n\n\n\n\n","category":"module"},{"location":"api/#Public-API","page":"API","title":"Public API","text":"","category":"section"},{"location":"api/#Thermodynamics","page":"API","title":"Thermodynamics","text":"","category":"section"},{"location":"api/#Breeze.Thermodynamics.CondensedPhase","page":"API","title":"Breeze.Thermodynamics.CondensedPhase","text":"CondensedPhase(FT = Oceananigans.defaults.FloatType; latent_heat, heat_capacity)\n\nReturns CondensedPhase with specified parameters converted to FT.\n\nTwo examples of CondensedPhase are liquid and solid. When matter is converted from vapor to liquid, water molecules in the gas phase cluster together and slow down to form liquid with heat_capacity, The lost of molecular kinetic energy is called the latent_heat.\n\nLikewise, during deposition, water molecules in the gas phase cluster into ice crystals.\n\nArguments\n\nFT: Float type to use (defaults to Oceananigans.defaults.FloatType)\nlatent_heat: Difference between the internal energy of the gaseous phase at the energy_reference_temperature.\nheat_capacity: Heat capacity of the phase of matter.\n\n\n\n\n\n","category":"type"},{"location":"api/#Breeze.Thermodynamics.IdealGas","page":"API","title":"Breeze.Thermodynamics.IdealGas","text":"IdealGas{FT}\n\nA struct representing an ideal gas with molar mass and specific heat capacity.\n\nFields\n\nmolar_mass: Molar mass of the gas in kg/mol\nheat_capacity: Specific heat capacity at constant pressure in J/(kg¬∑K)\n\nExamples\n\ndry_air = IdealGas(molar_mass=0.02897, heat_capacity=1005)\n\n# output\n\"IdealGas{Float64}(molar_mass=0.02897, heat_capacity=1005)\"\n\n\n\n\n\n","category":"type"},{"location":"api/#Breeze.Thermodynamics.ThermodynamicConstants","page":"API","title":"Breeze.Thermodynamics.ThermodynamicConstants","text":"ThermodynamicConstants(FT = Oceananigans.defaults.FloatType;\n                       molar_gas_constant = 8.314462618,\n                       gravitational_acceleration = 9.81,\n                       energy_reference_temperature = 273.16,\n                       triple_point_temperature = 273.16,\n                       triple_point_pressure = 611.657,\n                       dry_air_molar_mass = 0.02897,\n                       dry_air_heat_capacity = 1005,\n                       vapor_molar_mass = 0.018015,\n                       vapor_heat_capacity = 1850,\n                       liquid = liquid_water(FT),\n                       solid = water_ice(FT))\n\nCreate ThermodynamicConstants with parameters that represent gaseous mixture of dry \"air\" and vapor, as well as condensed liquid and solid phases. The triple_point_temperature and triple_point_pressure may be combined with internal energy parameters for condensed phases to compute the vapor pressure at the boundary between vapor and a homogeneous sample of the condensed phase. The gravitational_acceleration parameter is included to compute reference_state quantities associated with hydrostatic balance.\n\nThe Clausius-Clapeyron relation describes the pressure-temperature relationship during phase transitions:\n\ndlog(p‚Å±)  dT = ‚Ñí‚Å±  (R‚Å± T¬≤)\n\nwhere:\n\np‚Å± is the saturation vapor pressure for a transition between vapor and the i-th phase\nT is temperature\n‚Ñí‚Å± is the latent heat of vaporization\nR‚Å± is the specific gas constant for the i-th phase\n\nFor water vapor, this integrates to:\n\np‚Å± = p·µó ≥ exp ‚Ñí‚Å± (1T·µó ≥ - 1T)  R‚Å± \n\nwhere\n\np·µó ≥ is the triple point pressure\nT·µó ≥ is the triple point temperature\n\nand it is calculated via saturation_vapor_pressure.\n\nNote: any reference values for pressure and temperature can be used in principle. The advantage of using reference values at the triple point is that the same values can then be used for both condensation (vapor ‚Üí liquid) and deposition (vapor ‚Üí ice).\n\n\n\n\n\n","category":"type"},{"location":"api/#Breeze.Thermodynamics.mixture_gas_constant-Tuple{Any, ThermodynamicConstants}","page":"API","title":"Breeze.Thermodynamics.mixture_gas_constant","text":"mixture_gas_constant(q, thermo)\n\nCompute the gas constant of moist air given the specific humidity q and thermodynamic parameters thermo.\n\nThe mixture gas constant is calculated as a weighted average of the dry air and water vapor gas constants:\n\nR_m = R_d (1 - q) + R_v q\n\nwhere:\n\nR_d is the dry air gas constant\nR_v is the water vapor gas constant\nq is the specific humidity (mass fraction of water vapor)\n\nArguments\n\nq: Specific humidity (dimensionless)\nthermo: ThermodynamicConstants instance containing gas constants\n\nReturns\n\nGas constant of the moist air mixture in J/(kg¬∑K)\n\n\n\n\n\n","category":"method"},{"location":"api/#Breeze.Thermodynamics.mixture_heat_capacity-Tuple{Any, ThermodynamicConstants}","page":"API","title":"Breeze.Thermodynamics.mixture_heat_capacity","text":"mixture_heat_capacity(q, thermo)\n\nCompute the heat capacity of state air given the total specific humidity q and assuming that condensate mass ratio q·∂ú ‚â™ q, where q‚Ñì is the mass ratio of liquid condensate.\n\n\n\n\n\n","category":"method"},{"location":"api/#MoistAirBuoyancies","page":"API","title":"MoistAirBuoyancies","text":"","category":"section"},{"location":"api/#Breeze.MoistAirBuoyancies.MoistAirBuoyancy","page":"API","title":"Breeze.MoistAirBuoyancies.MoistAirBuoyancy","text":"MoistAirBuoyancy(FT=Oceananigans.defaults.FloatType;\n                 thermodynamics = ThermodynamicConstants(FT),\n                 reference_constants = ReferenceStateConstants{FT}(101325, 290))\n\nReturn a MoistAirBuoyancy formulation that can be provided as input to an AtmosphereModel or an Oceananigans.NonhydrostaticModel.\n\nnote: Required tracers\nMoistAirBuoyancy requires tracers q and Œ∏ to be included in the model.\n\nExample\n\njulia> using Breeze, Oceananigans\n\njulia> buoyancy = MoistAirBuoyancy()\nMoistAirBuoyancy\n‚îú‚îÄ‚îÄ reference_constants: Breeze.Thermodynamics.ReferenceStateConstants{Float64}\n‚îî‚îÄ‚îÄ thermodynamics: ThermodynamicConstants\n\njulia> model = NonhydrostaticModel(; grid = RectilinearGrid(size=(8, 8, 8), extent=(1, 2, 3)),\n                                     buoyancy, tracers = (:Œ∏, :q))\nNonhydrostaticModel{CPU, RectilinearGrid}(time = 0 seconds, iteration = 0)\n‚îú‚îÄ‚îÄ grid: 8√ó8√ó8 RectilinearGrid{Float64, Periodic, Periodic, Bounded} on CPU with 3√ó3√ó3 halo\n‚îú‚îÄ‚îÄ timestepper: RungeKutta3TimeStepper\n‚îú‚îÄ‚îÄ advection scheme: Centered(order=2)\n‚îú‚îÄ‚îÄ tracers: (Œ∏, q)\n‚îú‚îÄ‚îÄ closure: Nothing\n‚îú‚îÄ‚îÄ buoyancy: MoistAirBuoyancy with gÃÇ = NegativeZDirection()\n‚îî‚îÄ‚îÄ coriolis: Nothing\n\n\n\n\n\n","category":"type"},{"location":"api/#AtmosphereModels","page":"API","title":"AtmosphereModels","text":"","category":"section"},{"location":"api/#Breeze.AtmosphereModels.AtmosphereModel-Tuple{Any}","page":"API","title":"Breeze.AtmosphereModels.AtmosphereModel","text":"AtmosphereModel(grid;\n                clock = Clock(grid),\n                thermodynamics = ThermodynamicConstants(eltype(grid)),\n                formulation = default_formulation(grid, thermodynamics),\n                absolute_humidity = DefaultValue(),\n                tracers = tuple(),\n                coriolis = nothing,\n                boundary_conditions = NamedTuple(),\n                forcing = NamedTuple(),\n                advection = WENO(order=5),\n                microphysics = WarmPhaseSaturationAdjustment(),\n                timestepper = :RungeKutta3)\n\nReturn an AtmosphereModel that uses the anelastic approximation following Pauluis (2008).\n\nExample\n\njulia> using Breeze, Breeze.AtmosphereModels, Oceananigans\n\njulia> grid = RectilinearGrid(size=(8, 8, 8), extent=(1, 2, 3));\n\njulia> model = AtmosphereModel(grid)\nAtmosphereModel{CPU, RectilinearGrid}(time = 0 seconds, iteration = 0)\n‚îú‚îÄ‚îÄ grid: 8√ó8√ó8 RectilinearGrid{Float64, Periodic, Periodic, Bounded} on CPU with 3√ó3√ó3 halo\n‚îú‚îÄ‚îÄ formulation: AnelasticFormulation(p‚ÇÄ=101325.0, Œ∏·µ£=288.0)\n‚îú‚îÄ‚îÄ timestepper: RungeKutta3TimeStepper\n‚îú‚îÄ‚îÄ advection scheme: WENO{3, Float64, Float32}(order=5)\n‚îú‚îÄ‚îÄ tracers: ()\n‚îú‚îÄ‚îÄ coriolis: Nothing\n‚îî‚îÄ‚îÄ microphysics: WarmPhaseSaturationAdjustment\n\nReferences\n\nPauluis, O. (2008). Thermodynamic consistency of the anelastic approximation for a moist atmosphere.   Journal of the Atmospheric Sciences 65, 2719‚Äì2729.\n\n\n\n\n\n","category":"method"},{"location":"api/#Private-API","page":"API","title":"Private API","text":"","category":"section"},{"location":"api/#Thermodynamics-2","page":"API","title":"Thermodynamics","text":"","category":"section"},{"location":"api/#Breeze.Thermodynamics.reference_density-Tuple{Any, Any, Any}","page":"API","title":"Breeze.Thermodynamics.reference_density","text":"reference_density(z, ref, thermo)\n\nCompute the reference density associated with the reference pressure and potential temperature. The reference density is defined as the density of dry air at the reference pressure and temperature.\n\n\n\n\n\n","category":"method"},{"location":"api/#Breeze.Thermodynamics.reference_density-Tuple{Any, ReferenceStateConstants, Any}","page":"API","title":"Breeze.Thermodynamics.reference_density","text":"reference_density(z, ref::ReferenceStateConstants, thermo)\n\nCompute the reference density at height z that associated with the reference pressure and potential temperature. The reference density is defined as the density of dry air at the reference pressure and temperature.\n\n\n\n\n\n","category":"method"},{"location":"api/#Breeze.Thermodynamics.saturation_specific_humidity-Tuple{Any, Any, Any, CondensedPhase}","page":"API","title":"Breeze.Thermodynamics.saturation_specific_humidity","text":"saturation_specific_humidity(T, œÅ, thermo, condensed_phase::CondensedPhase)\n\nCompute the saturation specific humidity for a gas at temperature T, total density œÅ, thermodynamics, and condensed_phase via:\n\nq·µõ = p·µõ  (œÅ R·µõ T) \n\nwhere p·µõ is the saturation_vapor_pressure, and R·µõ is the specific gas constant for water vapor.\n\n\n\n\n\n","category":"method"},{"location":"api/#Breeze.Thermodynamics.saturation_vapor_pressure-Tuple{Any, Any, CondensedPhase}","page":"API","title":"Breeze.Thermodynamics.saturation_vapor_pressure","text":"saturation_vapor_pressure(T, thermo, phase::CondensedPhase)\n\nCompute the saturation vapor pressure p·µõ over a fluid surface at phase (i.e., liquid or solid) from the Clausius-Clapeyron relation,\n\ndp·µõ  dT = p·µõ ‚Ñí·µõ(T)  (R·µõ T^2) \n\nwhere ‚ÑíÀ°(T) = ‚ÑíÀ°(T=0) + ŒîcÀ° T, with ŒîcÀ°  (c·µñ·µõ - c·µñÀ°) .\n\nThe saturation vapor pressure p·µõ is obtained after integrating the above from the triple point, i.e., p(T·µó ≥) = p·µó ≥ to get\n\np·µõ(T) = p·µó ≥ left ( fracTT·µó ≥ right )^ŒîcÀ°  R·µõ exp left  (1T·µó ≥ - 1T) ‚ÑíÀ°(T=0)  R·µõ right  \n\nNote that latent heat ‚Ñí‚ÇÄ is at the reference temperature T‚ÇÄ and that ‚Ñí(T=0) = ‚Ñí‚ÇÄ - ŒîcÀ° T‚ÇÄ.\n\n\n\n\n\n","category":"method"},{"location":"api/#MoistAirBuoyancies-2","page":"API","title":"MoistAirBuoyancies","text":"","category":"section"},{"location":"api/#Breeze.MoistAirBuoyancies.temperature-Union{Tuple{FT}, Tuple{Breeze.MoistAirBuoyancies.HeightReferenceThermodynamicState{FT}, Any, Any}} where FT","page":"API","title":"Breeze.MoistAirBuoyancies.temperature","text":"temperature(state::HeightReferenceThermodynamicState, ref, thermo)\n\nReturn the temperature T that satisfies saturation adjustment, that is, the temperature for which\n\nŒ∏ = 1 - ‚Ñí qÀ°  (c·µñ·µê T) T  Œ† \n\nwith qÀ° = max(0 q·µó - q·µõ) the condensate specific humidity, where q·µó is the total specific humidity, q·µõ is the saturation specific humidity.\n\nThe saturation adjustment temperature is obtained by solving r(T), where\n\nr(T)  T - Œ∏ Œ† - ‚Ñí qÀ°  (c·µñ·µê T) \n\nSolution of r(T) = 0 is found via the secant method.\n\n\n\n\n\n","category":"method"},{"location":"api/#AtmosphereModels-2","page":"API","title":"AtmosphereModels","text":"","category":"section"},{"location":"api/#Breeze.AtmosphereModels._pressure_correct_momentum!-Tuple{Any}","page":"API","title":"Breeze.AtmosphereModels._pressure_correct_momentum!","text":"Update the predictor momentum (œÅu, œÅv, œÅw) with the non-hydrostatic pressure via\n\nu^{n+1} = u^n - Œ¥‚Çìp_{NH} / Œîx * Œît\n\n\n\n\n\n","category":"method"},{"location":"api/#Oceananigans.TimeSteppers.compute_flux_bc_tendencies!-Tuple{AtmosphereModel}","page":"API","title":"Oceananigans.TimeSteppers.compute_flux_bc_tendencies!","text":"Apply boundary conditions by adding flux divergences to the right-hand-side. \n\n\n\n\n\n","category":"method"},{"location":"thermodynamics/#Atmosphere-Thermodynamics","page":"Thermodynamics","title":"Atmosphere Thermodynamics","text":"","category":"section"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"Breeze implements thermodynamic relations for moist atmospheres. By \"moist\", we mean that the atmosphere is a binary mixture of (i) \"dry\" air, and (ii) \"vapor\". The presence of moisture makes life interesting, because vapor can condense or solidify (and liquid can freeze) into droplets and particles of so many shapes and sizes.","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"On Earth, dry air is itself a mixture of gases, the vapor component is mathrmH_2 O, also known as \"water\". Liquid droplets, which include almost-suspended tiny droplets as well as big raindrops, and ice particles such as snow, graupel, and hail, are called \"condensates\". Breeze models dry air as having a fixed composition with constant molar mass. Dry air on Earth's is mostly nitrogen, oxygen, and argon, whose combination produces the typical (and Breeze's default) dry air molar mass","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"using Breeze\nthermo = ThermodynamicConstants()\nthermo.dry_air.molar_mass","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"Water vapor, which in Breeze has the default molar mass","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"thermo.vapor.molar_mass","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"is lighter than dry air. As a result, moist, humid air is lighter than dry air.","category":"page"},{"location":"thermodynamics/#Two-laws-for-ideal-gases","page":"Thermodynamics","title":"Two laws for ideal gases","text":"","category":"section"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"Both dry air and vapor are modeled as ideal gases, which means that the ideal gas law relates pressure p, temperature T, and density œÅ,","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"p = œÅ R T ","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"Above, R  ‚Ñõ  m is the specific gas constant given the molar or \"universal\" gas constant ‚Ñõ  831  mathrmJ  mathrmK^-1  mathrmmol^-1 and molar mass m of the gas species under consideration.","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"The first law of thermodynamics, aka \"conservation of energy\", states that infinitesimal changes in \"heat content\"[1] mathrmd mathcalH are related to infinitesimal changes in temperature mathrmd T and pressure mathrmd p according to:[2]","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"mathrmd mathcalH = c·µñ mathrmd T - fracmathrmd pœÅ ","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"[1]: mathcalH is called enthalpy","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"[2]: The conservation of energy states that any external heat input into the gas must equal the sum   of the change of the gas's internal energy and the work done by the gas, p  mathrmd V.   For atmospheric flows it's convenient to express everything per unit mass. Assuming the mass of   the fluid is conserved, we have that the work done per unit mass is p  mathrmd(rho^-1)   and the internal energy per unit mass is mathcalI  c·µõ mathrmd T.   Therefore, if mathrmd mathcalH is the change in heat content per unit mass,   we have:mathrmd mathcalH = c·µõ mathrmd T + p  mathrmd(œÅ^-1) By utilizing the identity mathrmd(p  œÅ) = p  mathrmd(œÅ^-1) + œÅ^-1 mathrmdp and using the ideal gas, we can rewrite the above conservation law as:mathrmd mathcalH = (c·µõ + R) mathrmd T - œÅ^-1 mathrmdp which is the expression in the main text after noting that the specific heat capacities under constant pressure and under constant volume are related via c·µñ  c·µõ + R.","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"where c·µñ is the specific heat capacity at constant pressure of the gas in question.","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"For example, to represent dry air typical for Earth, with molar mass m = 0029  mathrmkg  mathrmmol^-1 and constant-pressure heat capacity c^p = 1005  mathrmJ  mathrmkg^-1  mathrmK^-1, we write","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"using Breeze.Thermodynamics: IdealGas\ndry_air = IdealGas(molar_mass=0.029, heat_capacity=1005)","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"We can also change the properties of dry air by specifying new values when constructing ThermodynamicConstants,","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"weird_thermo = ThermodynamicConstants(dry_air_molar_mass=0.042, dry_air_heat_capacity=420)\nweird_thermo.dry_air","category":"page"},{"location":"thermodynamics/#Potential-temperature-and-\"adiabatic\"-transformations","page":"Thermodynamics","title":"Potential temperature and \"adiabatic\" transformations","text":"","category":"section"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"Within adiabatic transformations, mathrmd mathcalH = 0. Then, combining the ideal gas law with conservation of energy yields","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"fracmathrmd TT = fracRc·µñ fracmathrmd pp ","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"which implies that T  ( p  p‚ÇÄ )^R  c·µñ, where p‚ÇÄ is some reference pressure value.","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"As a result, the potential temperature, Œ∏, defined as","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"Œ∏  T big  left ( fracpp‚ÇÄ right )^R  c·µñ = fracTŒ† ","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"remains constant under adiabatic transformations. Notice that above, we also defined the Exner function, Œ†  ( p  p‚ÇÄ )^R  c·µñ.","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"note: About subscripts\nThe subscript \"0\" typically indicates some quantity evaluated at the surface z=0. By convention, we tend to invoke constants that represent profiles evaluated at z=0: i.e., p‚ÇÄ = p(z=0), T‚ÇÄ = T(z=0), etc. This implies that the potential temperature under adiabatic transformation is Œ∏(z) = Œ∏‚ÇÄ = T‚ÇÄ.","category":"page"},{"location":"thermodynamics/#Hydrostatic-balance","page":"Thermodynamics","title":"Hydrostatic balance","text":"","category":"section"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"Next we consider a reference state that does not exchange energy with its environment (i.e., mathrmd mathcalH = 0) and thus has constant potential temperature","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"Œ∏‚ÇÄ = T·µ£ left ( fracp‚ÇÄp·µ£ right )^R  c·µñ ","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"note: Reference states\nSubscripts r indicate a reference state. The adiabatic, hydrostatically-balanced reference state in the process of elucidation presently has a z dependent reference pressure p·µ£(z), density œÅ·µ£(z), and temperature T·µ£(z). This reference state also has a constant potential temperature Œ∏·µ£, which we attempt to clarify by writing Œ∏‚ÇÄ (since it's constant, it has the same value at z=0 as at any height). We apologize that our notation differs from the usual in which 0 subscripts indicate \"reference\" (ü§î) and 00 (ü´£) means z=0.","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"Hydrostatic balance requires","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"_z p·µ£ = - œÅ·µ£ g ","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"where g is gravitational acceleration, naturally by default","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"thermo.gravitational_acceleration","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"By combining the hydrostatic balance with the ideal gas law and the definition of potential temperature we get","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"fracp·µ£p‚ÇÄ = left (1 - fracg zc·µñ Œ∏‚ÇÄ right )^c·µñ  R ","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"Thus","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"T·µ£(z) = Œ∏‚ÇÄ left ( fracp·µ£p‚ÇÄ right )^R  c·µñ = Œ∏‚ÇÄ left ( 1 - fracg zc·µñ Œ∏‚ÇÄ right ) ","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"and","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"œÅ·µ£(z) = fracp‚ÇÄR·µà Œ∏‚ÇÄ left ( 1 - fracg zc·µñ Œ∏‚ÇÄ right )^c·µñ  R - 1 ","category":"page"},{"location":"thermodynamics/#An-example-of-a-dry-reference-state-in-Breeze","page":"Thermodynamics","title":"An example of a dry reference state in Breeze","text":"","category":"section"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"We can visualise a hydrostatic reference profile evaluating Breeze's reference-state utilities (which assume a dry reference state) on a one-dimensional RectilinearGrid. In the following code, the superscript d denotes dry air, e.g., an ideal gas with R·µà = 28671  mathrmJ  mathrmK^-1:","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"using Breeze\nusing Breeze.Thermodynamics: reference_pressure, reference_density\nusing CairoMakie\n\nthermo = ThermodynamicConstants()\nconstants = ReferenceStateConstants(base_pressure=101325, potential_temperature=288)\ngrid = RectilinearGrid(size=160, z=(0, 12_000), topology=(Flat, Flat, Bounded))\n\np·µ£ = CenterField(grid)\nœÅ·µ£ = CenterField(grid)\n\nset!(p·µ£, z -> reference_pressure(z, constants, thermo))\nset!(œÅ·µ£, z -> reference_density(z, constants, thermo))\n\nR·µà = Breeze.Thermodynamics.dry_air_gas_constant(thermo)\nc·µñ·µà = thermo.dry_air.heat_capacity\np‚ÇÄ = constants.base_pressure\nŒ∏‚ÇÄ = constants.reference_potential_temperature\ng = thermo.gravitational_acceleration\n\n# Verify that T·µ£ = Œ∏‚ÇÄ (1 - g z / (c·µñ·µà Œ∏‚ÇÄ))\nz = KernelFunctionOperation{Center, Center, Center}(znode, grid, Center(), Center(), Center())\nT·µ£‚ÇÅ = Field(Œ∏‚ÇÄ * (p·µ£ / p‚ÇÄ)^(R·µà / c·µñ·µà))\nT·µ£‚ÇÇ = Field(Œ∏‚ÇÄ * (1 - g * z / (c·µñ·µà * Œ∏‚ÇÄ)))\n\nfig = Figure()\n\naxT = Axis(fig[1, 1]; xlabel = \"Temperature (·µíK)\", ylabel = \"Height (m)\")\nlines!(axT, T·µ£‚ÇÅ)\nlines!(axT, T·µ£‚ÇÇ, linestyle = :dash, color = :orange, linewidth = 2)\n\naxp = Axis(fig[1, 2]; xlabel = \"Pressure (10‚Åµ Pa)\", yticklabelsvisible = false)\nlines!(axp, p·µ£ / 1e5)\n\naxœÅ = Axis(fig[1, 3]; xlabel = \"Density (kg m‚Åª¬≥)\", yticklabelsvisible = false)\nlines!(axœÅ, œÅ·µ£)\n\nfig","category":"page"},{"location":"thermodynamics/#Thermodynamic-relations-for-gaseous-mixtures","page":"Thermodynamics","title":"Thermodynamic relations for gaseous mixtures","text":"","category":"section"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"\"Moist air\" is conceived to be a mixture of two gas phases: \"dry air\" (itself a mixture of gases) and water vapor, as well as a collection of liquid droplet and solid ice particle \"condensates\". We assume that the volume of the condensates is negligible, such that the total pressure is the sum of partial pressures of vapor and dry air,","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"p = p·µà + p·µõ ","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"(Superscripts d and v denote dry air and vapor respectively.)","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"The partial pressure of the dry air and vapor components are related to the component densities œÅ·µà and œÅ·µõ through the ideal gas law,","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"p·µà = œÅ·µà R·µà T qquad textand qquad p·µõ = œÅ·µõ R·µõ T ","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"where T is temperature, R‚Å± = ‚Ñõ  m^Œ≤ is the specific gas constant for component Œ≤, ‚Ñõ  is the molar or \"universal\" gas constant, and m^Œ≤ is the molar mass of component Œ≤.","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"Central to Breeze's implementation of moist thermodynamics is a struct that holds parameters like the molar gas constant and molar masses,","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"thermo = ThermodynamicConstants()","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"The default parameter evince basic facts about water vapor air typical to Earth's atmosphere: for example, the molar masses of dry air (itself a mixture of mostly nitrogen, oxygen, and argon), and water vapor are m·µà = 0029  mathrmkg  mathrmmol^-1 and m·µõ = 0018  mathrmkg  mathrmmol^-1.","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"To write the effective gas law for moist air, we introduce the mass ratios, e.g., specific humidity and specific hydrometeor contents,","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"q·µà  fracœÅ·µàœÅ qquad textand qquad q·µõ  fracœÅ·µõœÅ ","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"where œÅ is total density of the fluid including dry air, vapor, and condensates, œÅ·µà is the density of dry air, and œÅ·µõ is the density of vapor. It's then convenient to introduce the \"mixture\" gas constant R·µê(q·µõ) such that","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"p = œÅ R·µê T qquad textwhere qquad R·µê  q·µà R·µà + q·µõ R·µõ ","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"In \"clear\" (not cloudy) air, we have that q·µà = 1 - q·µõ. More generally, q·µà = 1 - q·µõ - q·∂ú, where q·∂ú is the total mass ratio of condensed species. In most situations on Earth, q·∂ú  q·µõ.","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"# Compute mixture properties for air with 0.01 specific humidity\nq·µõ = 0.01 # 1% water vapor by mass\nR·µê = mixture_gas_constant(q·µõ, thermo)","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"We likewise define a mixture heat capacity via c·µñ·µê = q·µà c·µñ·µà + q·µõ c·µñ·µõ,","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"q = 0.01 # 1% water vapor by mass\nc·µñ·µê = mixture_heat_capacity(q·µõ, thermo)","category":"page"},{"location":"thermodynamics/#Liquid-ice-potential-temperature","page":"Thermodynamics","title":"Liquid-ice potential temperature","text":"","category":"section"},{"location":"thermodynamics/#The-Clausius‚ÄìClapeyron-relation-and-saturation-specific-humidity","page":"Thermodynamics","title":"The Clausius‚ÄìClapeyron relation and saturation specific humidity","text":"","category":"section"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"The Clausius‚ÄìClapeyron relation for an ideal gas","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"fracmathrmd p·µõmathrmd T = fracp·µõ ‚Ñí^Œ≤(T)R·µõ T^2 ","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"where p·µõ is saturation vapor pressure, T is temperature, R·µõ is the specific gas constant for vapor, ‚Ñí^Œ≤(T) is the latent heat of the transition from vapor to the Œ≤ phase (e.g., Œ≤ = l for vapor ‚Üí liquid and Œ≤ = i for vapor to ice).","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"For a thermodynamic formulation that uses constant (i.e. temperature-independent) specific heats, the latent heat of a phase transition is linear in temperature. For example, for phase change from vapor to liquid,","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"‚ÑíÀ°(T) = ‚ÑíÀ°(T=0) + big ( underbracec·µñ·µõ - c·µñÀ°_ŒîcÀ° big ) T ","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"where ‚ÑíÀ°(T=0) is the latent heat at absolute zero, T = 0  mathrmK. By integrating from the triple-point temperature T·µó ≥ for which p(T·µó ≥) = p·µó ≥, we get","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"p·µõ(T) = p·µó ≥ left ( fracTT·µó ≥ right )^ŒîcÀ°  R·µõ exp left  frac‚ÑíÀ°(T=0)R·µõ left (frac1T·µó ≥ - frac1T right ) right  ","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"Consider parameters for liquid water,","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"using Breeze.Thermodynamics: CondensedPhase\nliquid_water = CondensedPhase(latent_heat=2500800, heat_capacity=4181)","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"or water ice,","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"water_ice = CondensedPhase(latent_heat=2834000, heat_capacity=2108)","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"The saturation vapor pressure is","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"using Breeze\nusing Breeze.Thermodynamics: saturation_vapor_pressure\n\nthermo = ThermodynamicConstants()\n\nT = collect(200:0.1:320)\np·µõÀ°‚Å∫ = [saturation_vapor_pressure(T‚Å±, thermo, thermo.liquid) for T‚Å± in T]\np·µõ‚Å±‚Å∫ = [saturation_vapor_pressure(T‚Å±, thermo, thermo.solid) for T‚Å± in T]\np·µõ‚Å±‚Å∫[T .> thermo.triple_point_temperature] .= NaN\n\nusing CairoMakie\n\nfig = Figure()\nax = Axis(fig[1, 1], xlabel=\"Temperature (·µíK)\", ylabel=\"Saturation vapor pressure p·µõ‚Å∫ (Pa)\", yscale = log10, xticks=200:20:320)\nlines!(ax, T, p·µõÀ°‚Å∫, label=\"vapor pressure over liquid\")\nlines!(ax, T, p·µõ‚Å±‚Å∫, linestyle=:dash, label=\"vapor pressure over ice\")\naxislegend(ax, position=:rb)\nfig","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"The saturation specific humidity is","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"q·µõ  fracœÅ·µõœÅ = fracp·µõœÅ R·µê T ","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"and this is what it looks like:","category":"page"},{"location":"thermodynamics/","page":"Thermodynamics","title":"Thermodynamics","text":"using Breeze\nusing Breeze.MoistAirBuoyancies: saturation_specific_humidity\n\nthermo = ThermodynamicConstants()\nref = ReferenceStateConstants(base_pressure=101325, potential_temperature=288)\n\nz = 0\nT = collect(273.2:0.1:313.2)\nq·µõ‚Å∫ = [saturation_specific_humidity(T‚Å±, z, ref, thermo, thermo.liquid) for T‚Å± in T]\n\nusing CairoMakie\n\nfig = Figure()\nax = Axis(fig[1, 1], xlabel=\"Temperature (·µíK)\", ylabel=\"Saturation specific humidity q·µõ‚Å∫ (kg kg‚Åª¬π)\")\nlines!(ax, T, q·µõ‚Å∫)\nfig","category":"page"},{"location":"appendix/notation/#Notation","page":"Notation","title":"Notation","text":"","category":"section"},{"location":"appendix/notation/","page":"Notation","title":"Notation","text":"This appendix establishes a common notation across the documentation and source. Each entry lists a mathematical symbol, the Unicode form commonly used in the codebase, and a brief description. Mathematical symbols are shown with inline math, while the Unicode column shows the exact glyphs used in code.","category":"page"},{"location":"appendix/notation/","page":"Notation","title":"Notation","text":"mathematical symbol unicode description\np p Pressure\np_r(z) p·µ£ Hydrostatic reference pressure at height z\np_0 p‚ÇÄ Base (surface) reference pressure\np_h p‚Çï‚Ä≤ Hydrostatic pressure anomaly, _z p_h = - œÅ_r b\np_n p‚Çô Nonhydrostatic pressure (projection/correction potential)\nrho œÅ Density\nrho_r(z) œÅ·µ£ Reference density at height z\nboldsymbolu = (uvw) u, v, w Velocity components (x, y, z)\nrho_ru rho_rv rho_rw œÅu, œÅv, œÅw Momentum components (œÅ·µ£-weighted velocities)\ng g Gravitational acceleration\nT T Temperature\ntheta Œ∏ Potential temperature\ntheta_r Œ∏·µ£ Reference potential temperature (constant)\nalpha Œ± Specific volume, Œ± = 1œÅ or Œ± = R^m T  p_r in anelastic\nalpha_r Œ±·µ£ Reference specific volume, Œ±_r = R^d Œ∏_r  p_r\nPi Œ† Exner function, Pi = (p_rp_0)^R^mc^pm\nR^d R·µà Dry air gas constant\nR^v R·µõ Water vapor gas constant\nR^m R·µê Mixture gas constant, function of q\nc^pd c·µñ·µà Heat capacity of dry air at constant pressure\nc^pv c·µñ·µõ Heat capacity of vapor at constant pressure\nc^pm c·µñ·µê Mixture heat capacity at constant pressure\nq q Specific humidity (vapor mass fraction)\nq^t q·µó Total specific humidity (vapor + condensates)\nq^v q·µõ Water vapor specific humidity\nq^ell qÀ° Liquid water specific humidity\nq^i qi Ice specific humidity\nq^v+ q·µõ‚Å∫ Saturation specific humidity over liquid/ice (context-dependent)\nmathcalL^v ‚Ñí·µõ Latent heat of vaporization\nmathcalR ‚Ñõ Universal (molar) gas constant\nb b Buoyancy, b = g (Œ± - Œ±_r)  Œ±_r\nDelta t Œît Time step\nDelta z Œîz Vertical grid spacing","category":"page"},{"location":"appendix/notation/","page":"Notation","title":"Notation","text":"Notes:","category":"page"},{"location":"appendix/notation/","page":"Notation","title":"Notation","text":"Reference-state quantities use a subscript r (e.g., p_r, rho_r), following the Thermodynamics docs and code.\nPhase or mixture identifiers (d, v, m) appear as superscripts (e.g., R^d, c^pm), matching usage in the codebase (e.g., R·µà, c·µñ·µê).\nConservative variables are typically stored in œÅ·µ£-weighted form in the code (e.g., œÅu, œÅv, œÅw, œÅe, œÅq·µó).","category":"page"},{"location":"microphysics/saturation_adjustment/#Warm-phase-saturation-adjustment","page":"Warm phase saturation adjustment","title":"Warm-phase saturation adjustment","text":"","category":"section"},{"location":"microphysics/saturation_adjustment/","page":"Warm phase saturation adjustment","title":"Warm phase saturation adjustment","text":"Warm-phase saturation adjustment is a model for water droplet nucleation that assumes that water vapor in excess of the saturation specific humidity is instantaneously converted to liquid water. Mixed-phase saturation adjustment is described by Chammas et al. (2023). Saturation adjustment may be formulated as a nonlinear algebraic equation that relates temperature, potential temperature, and total specific humidity, derived from the definition of liquid potential temperature,","category":"page"},{"location":"microphysics/saturation_adjustment/","page":"Warm phase saturation adjustment","title":"Warm phase saturation adjustment","text":"Œ∏ = fracTŒ† left 1 - frac‚Ñí·µ•‚ÇÄc·µñ·µê T max left 0 q·µó - q·µõ(T) right  right  ","category":"page"},{"location":"microphysics/saturation_adjustment/","page":"Warm phase saturation adjustment","title":"Warm phase saturation adjustment","text":"where Œ† is the Exner function, Œ∏ is potential temperature, T is temperature, ‚Ñí·µ•‚ÇÄ is the reference latent heat of vaporization, q·µó is the total specific humidity, q·µõ is the saturation specific humidity, and c·µñ·µê is the moist air specific heat. The condensate specific humidity is qÀ° = max(0 q·µó - q·µõ): qÀ° = 0 if the air is undersaturated with q·µó  q·µõ. Both Œ† and c·µñ·µê depend on the dry and vapor mass fractions q·µà = 1 - q·µó and q·µõ = q·µó - qÀ°, and the saturation specific humidityq·µõ is an increasing function of temperature T.","category":"page"},{"location":"microphysics/saturation_adjustment/","page":"Warm phase saturation adjustment","title":"Warm phase saturation adjustment","text":"Rewriting the potential temperature relation above, saturation adjustment requires solving r(T) = 0, where","category":"page"},{"location":"microphysics/saturation_adjustment/","page":"Warm phase saturation adjustment","title":"Warm phase saturation adjustment","text":"r(T)  T - Œ∏ Œ† - frac‚Ñí·µ•‚ÇÄc·µñ·µê max0 q·µó - q·µõ(T) ","category":"page"},{"location":"microphysics/saturation_adjustment/","page":"Warm phase saturation adjustment","title":"Warm phase saturation adjustment","text":"We use a secant method after checking for Œ∏ = 0 and qÀ° = 0 given the guess T‚ÇÅ = Œ∏ Œ†(q·µó). If q·µó  q·µõ(T‚ÇÅ), then we are guaranteed that T  T‚ÇÅ because q·µõ is an increasing function of T. We initialize the secant iteration with a second guess T‚ÇÇ = Œ∏ Œ† - q·µó - q·µõ(T‚ÇÅ) ‚Ñí·µ•‚ÇÄ  c·µñ·µê. See temperature for more details.","category":"page"},{"location":"microphysics/saturation_adjustment/","page":"Warm phase saturation adjustment","title":"Warm phase saturation adjustment","text":"As an example, we consider an air parcel at sea-level and with potential temperature of Œ∏ = 290·µíK, within a reference state with base pressure of 101325 Pa and a reference potential temperature 288·µíK. The saturation specific humidity is then","category":"page"},{"location":"microphysics/saturation_adjustment/","page":"Warm phase saturation adjustment","title":"Warm phase saturation adjustment","text":"using Breeze\nusing Breeze.MoistAirBuoyancies: saturation_specific_humidity, HeightReferenceThermodynamicState\n\nthermo = ThermodynamicConstants()\nref = ReferenceStateConstants(base_pressure=101325, potential_temperature=288)\n\nz = 0.0    # [m] height\nŒ∏ = 290.0  # [·µíK] potential temperature\nq·µõ‚Å∫‚ÇÄ = saturation_specific_humidity(Œ∏, z, ref, thermo, thermo.liquid)","category":"page"},{"location":"microphysics/saturation_adjustment/","page":"Warm phase saturation adjustment","title":"Warm phase saturation adjustment","text":"Recall that the specific humidity is unitless, or has units \"kg  kg\": kg of water vapor per total kg of air. We then perform a non-trivial saturation adjustment by computing temperature given a total specific humidity slightly above saturation:","category":"page"},{"location":"microphysics/saturation_adjustment/","page":"Warm phase saturation adjustment","title":"Warm phase saturation adjustment","text":"using Breeze.MoistAirBuoyancies: temperature\n\nq·µó = 0.012   # [kg kg‚Åª¬π] total specific humidity\nU = HeightReferenceThermodynamicState(Œ∏, q·µó, z)\nT = temperature(U, ref, thermo)","category":"page"},{"location":"microphysics/saturation_adjustment/","page":"Warm phase saturation adjustment","title":"Warm phase saturation adjustment","text":"Finally, we recover the amount of liquid condensate by subtracting the saturation specific humidity from the total:","category":"page"},{"location":"microphysics/saturation_adjustment/","page":"Warm phase saturation adjustment","title":"Warm phase saturation adjustment","text":"q·µõ‚Å∫ = saturation_specific_humidity(T, z, ref, thermo, thermo.liquid)\nqÀ° = q·µó - q·µõ‚Å∫","category":"page"},{"location":"microphysics/saturation_adjustment/#Saturation-adjustment-with-varying-total-specific-humidity","page":"Warm phase saturation adjustment","title":"Saturation adjustment with varying total specific humidity","text":"","category":"section"},{"location":"microphysics/saturation_adjustment/","page":"Warm phase saturation adjustment","title":"Warm phase saturation adjustment","text":"As a second example, we examine the dependence of temperature on total specific humidity when the potential temperature is constant:","category":"page"},{"location":"microphysics/saturation_adjustment/","page":"Warm phase saturation adjustment","title":"Warm phase saturation adjustment","text":"q·µó = 0:1e-4:0.04 # [kg kg‚Åª¬π] total specific humidity\nU = [HeightReferenceThermodynamicState(Œ∏, q·µó‚Å±, z) for q·µó‚Å± in q·µó]\nT = [temperature(U‚Å±, ref, thermo) for U‚Å± in U]\n\n## Compare with a simple piecewise linear model\n‚Ñí·µ•‚ÇÄ = thermo.liquid.latent_heat\nc·µñ·µà = thermo.dry_air.heat_capacity\nTÃÉ = [290 + ‚Ñí·µ•‚ÇÄ / c·µñ·µà * max(0, q·µó‚Å± - q·µõ‚Å∫‚ÇÄ) for q·µó‚Å± in q·µó]\n\nusing CairoMakie\n\nfig = Figure()\nax = Axis(fig[1, 1], xlabel=\"Total specific humidity (kg kg‚Åª¬π)\", ylabel=\"Temperature (·µíK)\")\nlines!(ax, q·µó, T, label=\"Temperature from saturation adjustment\")\nlines!(ax, q·µó, TÃÉ, label=\"Temperature from linearized formula\", linewidth=2)\naxislegend(ax, position=:lt)\nfig","category":"page"},{"location":"microphysics/saturation_adjustment/#Saturation-adjustment-with-varying-height","page":"Warm phase saturation adjustment","title":"Saturation adjustment with varying height","text":"","category":"section"},{"location":"microphysics/saturation_adjustment/","page":"Warm phase saturation adjustment","title":"Warm phase saturation adjustment","text":"For a third example, we consider a state with constant potential temperature and total specific humidity, but at varying heights:","category":"page"},{"location":"microphysics/saturation_adjustment/","page":"Warm phase saturation adjustment","title":"Warm phase saturation adjustment","text":"q·µó = 0.005\nz = 0:100:10e3\n\nT = [temperature(HeightReferenceThermodynamicState(Œ∏, q·µó, z·µè), ref, thermo) for z·µè in z]\nq·µõ‚Å∫ = [saturation_specific_humidity(T[k], z[k], ref, thermo, thermo.liquid) for k = 1:length(z)]\nqÀ° = [max(0, q·µó - q·µõ‚Å∫·µè) for q·µõ‚Å∫·µè in q·µõ‚Å∫]\nrh = [100 * min(q·µó, q·µõ‚Å∫·µè) / q·µõ‚Å∫·µè for q·µõ‚Å∫·µè in q·µõ‚Å∫]\n\nc·µñ·µà = thermo.dry_air.heat_capacity\ng = thermo.gravitational_acceleration\n\nfig = Figure(size=(700, 350))\n\nyticks = 0:2e3:10e3\n\naxT = Axis(fig[1, 1:2]; xlabel = \"Temperature (·µíK)\", ylabel = \"Height (m)\", yticks)\naxq‚Å∫ = Axis(fig[1, 3]; xlabel = \"Saturation\\n specific humidity\\n (kg kg‚Åª¬π)\",\n                       yticks, yticklabelsvisible = false)\naxqÀ° = Axis(fig[1, 4]; xlabel = \"Liquid\\n specific humidity\\n (kg kg‚Åª¬π)\",\n                       yticks, yticklabelsvisible = false)\n\naxrh = Axis(fig[1, 5]; xlabel = \"Relative\\n humidity (%)\",\n                       xticks = 0:20:100,\n                       yticks, yticklabelsvisible = false)\n\nlines!(axT, T, z)\nlines!(axT, T[1] .- g * z / c·µñ·µà, z, linestyle = :dash, color = :orange, linewidth = 2)\nlines!(axq‚Å∫, q·µõ‚Å∫, z)\nlines!(axqÀ°, qÀ°, z)\nlines!(axrh, rh, z)\n\nfig","category":"page"},{"location":"microphysics/microphysics_overview/#Microphysics","page":"Overview","title":"Microphysics","text":"","category":"section"},{"location":"microphysics/microphysics_overview/","page":"Overview","title":"Overview","text":"In atmospheric modeling, \"microphysics\" largely overlaps with \"cloud physics\" and concerns the formation, development, and precipitation of clouds. More generally, \"microphysics\" encompasses panoply of physical processes associated with (i) the conversion of water between vapor, liquid, and ice phases, and (ii) the interaction and transformation of \"cloud particles\", which include droplets, ice particles, and aerosols. For example: microphysical processes include droplet nucleation on aerosol particles; liquid freezing and vapor solidification; chemical and humidity-based transformations of aerosol particles; the agglomeration of ice particles into snowflakes; collisions and breakup of falling droplets (rain); collision between ice particles and droplets or wholesale freezing of droplets to form hail (e.g. Straka (2009)).","category":"page"},{"location":"microphysics/microphysics_overview/","page":"Overview","title":"Overview","text":"Breeze microphysics is nascent and under active development. Breeze aims to eventually provide a wide range of microphysical models, ranging from simple warm-phase saturation adjustment, to the bulk schemes provided by the Climate Modeling Alliance's CloudMicrophysics.jl, to superdroplet schemes, to spectral bin schemes that include a spectrum of droplet sizes, ice particle shapes and aerosol types.","category":"page"},{"location":"dynamics/#Dynamics","page":"Dycore equations and algorithms","title":"Dynamics","text":"","category":"section"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"This page summarizes the governing equations behind Breeze‚Äôs atmospheric dynamics and the anelastic formulation used by AtmosphereModel, following the thermodynamically consistent framework of Pauluis (2008) Pauluis (2008).","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"We begin with the compressible Navier‚ÄìStokes momentum equations and reduce them to an anelastic, conservative form. We then introduce the moist static energy equation and outline the time-discretized pressure correction used to enforce the anelastic constraint.","category":"page"},{"location":"dynamics/#Compressible-momentum-equations","page":"Dycore equations and algorithms","title":"Compressible momentum equations","text":"","category":"section"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"Let œÅ denote density, boldsymbolu velocity, p pressure, boldsymbolf non-pressure body forces (e.g., Coriolis), and boldsymboltau subgrid/viscous stresses. With gravity g hatboldsymbolz, the inviscid compressible equations in flux form are","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"beginaligned\ntextMass  partial_t rho + nablacdot(rhoboldsymbolu) = 0 \ntextMomentum  partial_t(rhoboldsymbolu) + nablacdot(rhoboldsymboluboldsymbolu) + nabla p \n= rhoghatboldsymbolz + rhoboldsymbolf + nablacdotboldsymboltau \nendaligned","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"For moist flows we also track total water (vapor + condensates) via","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"partial_t(rho q^t) + nablacdot(rho q^tboldsymbolu) = S_q ","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"where q^t is total specific humidity and S_q accounts for sources/sinks from microphysics and boundary fluxes.","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"Thermodynamic relations (mixture gas constant R^m, heat capacity c^pm, Exner function, etc.) are summarized on the Thermodynamics page.","category":"page"},{"location":"dynamics/#Anelastic-approximation","page":"Dycore equations and algorithms","title":"Anelastic approximation","text":"","category":"section"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"To filter acoustic waves while retaining compressibility effects in buoyancy and thermodynamics, we linearize about a hydrostatic, horizontally uniform reference state (p_r(z) rho_r(z)) with constant reference potential temperature theta_r. The key assumptions are","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"Small Mach number and small relative density perturbations except in buoyancy.\nHydrostatic reference balance: partial_z p_r = -rho_r g.\nMass flux divergence constraint: nablacdot(rho_rboldsymbolu) = 0.","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"Define the specific volume of moist air and its reference value as","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"alpha = fracR^m Tp_r  qquad alpha_r = fracR^dtheta_rp_r ","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"where R^m is the mixture gas constant and R^d is the dry-air gas constant. The buoyancy appearing in the vertical momentum is","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"b equiv gfracalpha - alpha_ralpha_r ","category":"page"},{"location":"dynamics/#Conservative-anelastic-system","page":"Dycore equations and algorithms","title":"Conservative anelastic system","text":"","category":"section"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"With rho_r(z) fixed by the reference state, the prognostic equations advanced in Breeze are written in conservative form for the rho_r-weighted fields:","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"Continuity (constraint):","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"nablacdot(rho_rboldsymbolu) = 0 ","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"Momentum:","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"partial_t(rho_rboldsymbolu) + nablacdot(rho_rboldsymboluboldsymbolu) \n= -rho_rnabla phi + rho_rbhatboldsymbolz + rho_rboldsymbolf + nablacdotboldsymboltau ","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"where phi is a nonhydrostatic pressure correction potential defined by the projection step (see below). Pressure is decomposed as p = p_r(z) + p_h(xyzt) + p_n, where p_h is a hydrostatic anomaly (obeying partial_z p_h = -rho_r b) and p_n is the nonhydrostatic component responsible for enforcing the anelastic constraint. In the discrete formulation used here, phi coincides with the pressure correction variable.","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"Total water:","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"partial_t(rho_r q^t) + nablacdot(rho_r q^tboldsymbolu) = S_q ","category":"page"},{"location":"dynamics/#Moist-static-energy-(Pauluis,-2008)","page":"Dycore equations and algorithms","title":"Moist static energy (Pauluis, 2008)","text":"","category":"section"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"Following Pauluis (2008), Breeze advances a conservative moist static energy density","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"rho_r e equiv rho_rc^pdtheta ","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"where c^p^d is the dry-air heat capacity at constant pressure and theta is the (moist) potential temperature. The prognostic equation reads","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"partial_t(rho_r e) + nablacdot(rho_r eboldsymbolu) \n= rho_rwb  +  S_e ","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"with vertical velocity w, buoyancy b as above, and S_e including microphysical and external energy sources/sinks. The rho_r w b term is the buoyancy flux that links the energy and momentum budgets in the anelastic limit.","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"Thermodynamic closures needed for R^m, c^pm and the Exner function Pi = (p_rp_0)^R^mc^pm are given in Thermodynamics.","category":"page"},{"location":"dynamics/#Time-discretization-and-pressure-correction","page":"Dycore equations and algorithms","title":"Time discretization and pressure correction","text":"","category":"section"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"Breeze uses an explicit multi-stage time integrator for advection, Coriolis, buoyancy, forcing, and tracer terms, coupled with a projection step to enforce the anelastic constraint at each substep. Denote the predicted momentum by widetilde(rho_rboldsymbolu). The projection is","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"Solve the variable-coefficient Poisson problem for the pressure correction potential phi:","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"nablacdotbig( rho_r  nabla phi big) \n= frac1Delta t  nablacdotwidetilde(rho_rboldsymbolu) ","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"with periodic lateral boundaries and homogeneous Neumann boundary conditions in z.","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"Update momentum to enforce nablacdot(rho_rboldsymbolu^n+1)=0:","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"rho_rboldsymbolu^n+1 = widetilde(rho_rboldsymbolu)  -  Delta t rho_r  nabla phi ","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"In Breeze this projection is implemented as a Fourier‚Äìtridiagonal solve in the vertical with variable rho_r(z), aligning with the hydrostatic reference state. The hydrostatic pressure anomaly p_h can be obtained diagnostically by vertical integration of buoyancy and used when desired to separate hydrostatic and nonhydrostatic pressure effects.","category":"page"},{"location":"dynamics/#Symbols-and-closures-used-here","page":"Dycore equations and algorithms","title":"Symbols and closures used here","text":"","category":"section"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"rho_r(z), p_r(z): Reference density and pressure satisfying hydrostatic balance for a constant theta_r.\nalpha = R^m Tp_r, alpha_r = R^dtheta_rp_r: Specific volume and its reference value.\nb = g (alpha - alpha_r)alpha_r: Buoyancy.\ne = c^pdtheta: Energy variable used for moist static energy in the conservative equation.\nq^t: Total specific humidity (vapor + condensates).\nphi: Nonhydrostatic pressure correction potential used by the projection.","category":"page"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"See Thermodynamics for definitions of R^m(q), c^pm(q), and Pi.","category":"page"},{"location":"dynamics/#References","page":"Dycore equations and algorithms","title":"References","text":"","category":"section"},{"location":"dynamics/","page":"Dycore equations and algorithms","title":"Dycore equations and algorithms","text":"","category":"page"},{"location":"#Breeze.jl","page":"Home","title":"Breeze.jl","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Fast, friendly atmosphere simulations on CPUs and GPUs.","category":"page"},{"location":"","page":"Home","title":"Home","text":"Breeze provides software for flexible software package for finite-volume atmosphere simulations on CPUs and GPUs, based on Oceananigans. Like Oceananigans, it provides a radically productive user interface that makes simple simulations easy, and complex, creative simulations possible.","category":"page"},{"location":"#Features","page":"Home","title":"Features","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Breeze provides two ways to simulate moist atmospheres:","category":"page"},{"location":"","page":"Home","title":"Home","text":"A MoistAirBuoyancy that can be used with Oceananigans' NonhydrostaticModel to simulate atmospheric flows with the Boussinesq approximation.\nA prototype AtmosphereModel that uses the anelastic approximation following Pauluis (2008).","category":"page"},{"location":"#Installation","page":"Home","title":"Installation","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"To use Breeze, install directly from GitHub:","category":"page"},{"location":"","page":"Home","title":"Home","text":"using Pkg\nPkg.add(\"https://github.com/NumericalEarth/Breeze.jl.git\")","category":"page"},{"location":"#Quick-Start","page":"Home","title":"Quick Start","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"A basic free convection simulation:","category":"page"},{"location":"","page":"Home","title":"Home","text":"using Oceananigans\nusing Oceananigans.Units\nusing CairoMakie\nusing Breeze\n\nNx = Nz = 64\nLz = 4 * 1024\ngrid = RectilinearGrid(CPU(), size=(Nx, Nz), x=(0, 2Lz), z=(0, Lz), topology=(Periodic, Flat, Bounded))\n\nreference_constants = Breeze.Thermodynamics.ReferenceStateConstants(base_pressure=1e5, potential_temperature=288)\nbuoyancy = Breeze.MoistAirBuoyancy(; reference_constants)\n\nQ‚ÇÄ = 1000 # heat flux in W / m¬≤\nœÅ‚ÇÄ = Breeze.MoistAirBuoyancies.base_density(buoyancy) # air density at z=0\nc‚Çö = buoyancy.thermodynamics.dry_air.heat_capacity\nŒ∏_bcs = FieldBoundaryConditions(bottom=FluxBoundaryCondition(Q‚ÇÄ / (œÅ‚ÇÄ * c‚Çö)))\nq_bcs = FieldBoundaryConditions(bottom=FluxBoundaryCondition(1e-2))\n\nadvection = WENO()\ntracers = (:Œ∏, :q)\nmodel = NonhydrostaticModel(; grid, advection, buoyancy,\n                            tracers = (:Œ∏, :q),\n                            boundary_conditions = (Œ∏=Œ∏_bcs, q=q_bcs))\n\nŒîŒ∏ = 2 # ·µíK\nT‚Çõ = reference_constants.reference_potential_temperature # K\nŒ∏·µ¢(x, z) = T‚Çõ + ŒîŒ∏ * z / grid.Lz + 1e-2 * ŒîŒ∏ * randn()\nq·µ¢(x, z) = 0 # 1e-2 + 1e-5 * rand()\nset!(model, Œ∏=Œ∏·µ¢, q=q·µ¢)\n\nsimulation = Simulation(model, Œît=10, stop_time=2hours)\nconjure_time_step_wizard!(simulation, cfl=0.7)\n\nrun!(simulation)\n\nT = Breeze.TemperatureField(model)\nheatmap(T)","category":"page"}]
}
